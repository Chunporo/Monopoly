var k=Object.defineProperty;var y=(i,t,e)=>t in i?k(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(y(i,typeof t!="symbol"?t+"":t,e),e);import{_ as m,i as u,T as d}from"./index-d28cb020.js";class _{constructor(){r(this,"socket",null);r(this,"server",null);r(this,"playerId","");r(this,"currentRoom",null);r(this,"connected",!1);r(this,"isHost",!1);r(this,"eventCallbacks",[]);r(this,"playerCallbacks",[]);r(this,"chatCallbacks",[]);r(this,"disconnectCallbacks",[])}async connect(){this.connected=!0}async disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.server&&(this.server.stop(),this.server=null),this.connected=!1}isConnected(){return this.connected}async createRoom(t,e,s){return new Promise((a,n)=>{this.isHost=!0,m(()=>import("./index-d28cb020.js").then(c=>c.s),["assets/index-d28cb020.js","assets/index-17cddeb3.css"]).then(({main:c})=>{c(s,async(o,l)=>{this.server=l,l.code=o;try{this.socket=await u(d(o)),this.playerId=this.socket.id,this.setupSocketHandlers();const h={id:o,code:o,hostId:this.playerId,players:[],gameState:{currentPlayerId:"",turnNumber:0,diceRolls:null,lastAction:"",history:[]},maxPlayers:s,createdAt:Date.now(),status:"waiting"};this.currentRoom=h,a(h)}catch(h){n(h)}})})})}async joinRoom(t,e,s){return new Promise(async(a,n)=>{try{const c=d(t);this.socket=await u(c),this.playerId=this.socket.id,this.setupSocketHandlers(),this.socket.on("state",o=>{switch(o){case 0:const l={id:t,code:t,hostId:"",players:[],gameState:{currentPlayerId:"",turnNumber:0,diceRolls:null,lastAction:"",history:[]},maxPlayers:6,createdAt:Date.now(),status:"waiting"};this.currentRoom=l,a(l);break;case 1:n(new Error("Game has already started"));break;case 2:n(new Error("Room is full"));break;default:n(new Error("Unknown error"))}}),this.socket.emit("join",{name:e,icon:s})}catch(c){n(c)}})}async leaveRoom(){this.socket&&this.socket.disconnect(),this.currentRoom=null}async setReady(t){var e;(e=this.socket)==null||e.emit("ready",t)}async startGame(){var t;(t=this.socket)==null||t.emit("start_game")}async rollDice(){return new Promise(t=>{var e,s;(e=this.socket)==null||e.emit("roll_dice"),(s=this.socket)==null||s.on("dice_result",a=>{t(a)})})}async buyProperty(t){var e;(e=this.socket)==null||e.emit("buy_property",{position:t})}async skipProperty(){var t;(t=this.socket)==null||t.emit("skip_property")}async payRent(t,e){var s;(s=this.socket)==null||s.emit("pay_rent",{amount:t,toPlayerId:e})}async movePlayer(t){var e;(e=this.socket)==null||e.emit("move",{position:t})}async endTurn(){var t;(t=this.socket)==null||t.emit("end_turn")}async payJailFee(){var t;(t=this.socket)==null||t.emit("unjail","pay")}async useGetOutCard(){var t;(t=this.socket)==null||t.emit("unjail","card")}async rollForJail(){return new Promise(t=>{var e,s;(e=this.socket)==null||e.emit("unjail","roll"),(s=this.socket)==null||s.on("jail_roll_result",a=>{t(a)})})}async proposeTrade(t,e){var s;(s=this.socket)==null||s.emit("trade_propose",{toPlayerId:t,offer:e})}async acceptTrade(t){var e;(e=this.socket)==null||e.emit("trade_accept",{tradeId:t})}async rejectTrade(t){var e;(e=this.socket)==null||e.emit("trade_reject",{tradeId:t})}async sendMessage(t){var e;(e=this.socket)==null||e.emit("chat",{message:t})}onGameEvent(t){return this.eventCallbacks.push(t),()=>{this.eventCallbacks=this.eventCallbacks.filter(e=>e!==t)}}onPlayerUpdate(t){return this.playerCallbacks.push(t),()=>{this.playerCallbacks=this.playerCallbacks.filter(e=>e!==t)}}onChatMessage(t){return this.chatCallbacks.push(t),()=>{this.chatCallbacks=this.chatCallbacks.filter(e=>e!==t)}}onDisconnect(t){return this.disconnectCallbacks.push(t),()=>{this.disconnectCallbacks=this.disconnectCallbacks.filter(e=>e!==t)}}getCurrentRoom(){return this.currentRoom}getCurrentPlayer(){return this.currentRoom&&this.currentRoom.players.find(t=>t.id===this.playerId)||null}getPlayerId(){return this.playerId}getServer(){return this.server}getSocket(){return this.socket}setupSocketHandlers(){this.socket&&(this.socket.on("players_update",t=>{this.currentRoom&&(this.currentRoom.players=t),this.playerCallbacks.forEach(e=>e(t))}),this.socket.on("game_event",t=>{this.eventCallbacks.forEach(e=>e(t))}),this.socket.on("chat_message",t=>{this.chatCallbacks.forEach(e=>e(t))}),this.socket.on("disconnect",()=>{this.disconnectCallbacks.forEach(t=>t())}))}}export{_ as PeerJSGameService};
